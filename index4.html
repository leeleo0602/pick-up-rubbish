<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>SDGs 不塑永續-淨灘</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
html, body { margin:0; padding:0; overflow:hidden; font-family: sans-serif; background:#87CEEB; }
#gameContainer { position: relative; width: 100vw; height: 100vh; background: linear-gradient(to top, #fceabb, #87CEEB); overflow:hidden; }
h1 { position: absolute; top:10px; left:10px; font-size:28px; font-weight:bold; margin:0; z-index:1000; }
#scoreBoard { position:absolute; top:10px; right:10px; font-size:20px; font-weight:bold; z-index:1000; }
.cloud, .bird, .sun { position:absolute; }
.cloud { width:120px; height:60px; background:#fff; border-radius:50%; opacity:0.8; animation: floatCloud linear infinite; }
.bird { font-size:24px; animation: flyBird linear infinite; }
.sun { width:80px; height:80px; background:yellow; border-radius:50%; top:50px; left:50%; transform:translateX(-50%); animation: rotateSun 20s linear infinite; }
@keyframes floatCloud { 0% {left:-150px;} 100% {left:110%;} }
@keyframes flyBird { 0% {left:-50px;} 100% {left:110%;} }
@keyframes rotateSun { 0% {transform:translateX(-50%) rotate(0deg);} 100% {transform:translateX(-50%) rotate(360deg);} }
.wave { position:absolute; bottom:0; width:200%; height:50px; background:rgba(0, 119, 190,0.5); border-radius:100%; animation: waveAnim 4s ease-in-out infinite; }
@keyframes waveAnim { 0% {transform:translateX(0) translateY(0);} 50% {transform:translateX(-25%) translateY(5px);} 100% {transform:translateX(0) translateY(0);} }
.trash { position:absolute; font-size:24px; cursor:pointer; transition: transform 0.3s; }
#player { position:absolute; width:96px; height:96px; transition: left 0.05s linear, top 0.05s linear; z-index:500; }
#energyBar { position:absolute; height:8px; background:red; top:-10px; left:0; border-radius:4px; }
#tools { position:absolute; top:60px; right:10px; width:150px; z-index:1000; }
#tools button { display:block; margin:5px 0; width:100%; }
#audioToggle { position:absolute; top:10px; right:170px; cursor:pointer; }
</style>
</head>
<body>
<div id="gameContainer">
  <h1>SDGs 不塑永續-淨灘</h1>
  <div id="scoreBoard">分數: 0 | 剩餘垃圾: 50</div>
  <div id="audioToggle">🔊</div>
  <div id="tools">
    <button onclick="useMagnet()">磁鐵手套</button>
    <button onclick="useFan()">強力風扇</button>
    <button onclick="useRobot()">自動機器人</button>
  </div>
  <div class="sun"></div>
  <div class="wave" style="animation-delay:0s"></div>
  <div class="wave" style="animation-delay:2s"></div>
</div>

<script>
const game = document.getElementById('gameContainer');
let score = 0;
let totalTrash = 50;
let audioOn = true;

for(let i=0;i<5;i++){
  let cloud = document.createElement('div');
  cloud.className='cloud';
  cloud.style.top = Math.random()*150+'px';
  cloud.style.animationDuration = (30+Math.random()*20)+'s';
  cloud.style.opacity = 0.5+Math.random()*0.5;
  game.appendChild(cloud);
}
for(let i=0;i<3;i++){
  let bird = document.createElement('div');
  bird.className='bird';
  bird.style.top = 50 + Math.random()*100+'px';
  bird.style.animationDuration = (10+Math.random()*10)+'s';
  bird.innerHTML='🕊️';
  game.appendChild(bird);
}

const pickAudio = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YcQAAAD//w==");
const successAudio = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YcQAAAD//w==");

document.getElementById('audioToggle').onclick=()=>{audioOn=!audioOn; document.getElementById('audioToggle').innerText=audioOn?'🔊':'🔇'}

const trashTypes = [
  {icon:'<i class="fa-solid fa-bottle-water"></i>', points:5},
  {icon:'<i class="fa-regular fa-file-lines"></i>', points:10},
  {icon:'<i class="fa-solid fa-box"></i>', points:20},
  {icon:'<i class="fa-solid fa-bag-shopping"></i>', points:5},
  {icon:'<i class="fa-solid fa-cup-soda"></i>', points:10},
  {icon:'<i class="fa-solid fa-recycle"></i>', points:15}
];

let trashes = [];
for(let i=0;i<totalTrash;i++){
  let t = document.createElement('div');
  t.className='trash';
  let type = trashTypes[Math.floor(Math.random()*trashTypes.length)];
  t.innerHTML = type.icon;
  t.dataset.points = type.points;
  t.style.left = Math.random()*(window.innerWidth-30)+'px';
  t.style.top = (window.innerHeight/2 + Math.random()*(window.innerHeight/2 -30))+'px';
  t.style.transform = 'rotate('+Math.random()*360+'deg)';
  game.appendChild(t);
  trashes.push(t);
}

let player = document.createElement('div');
player.id='player';
player.style.left = window.innerWidth/2 + 'px';
player.style.top = window.innerHeight/2 + 'px';
player.innerHTML=`<div style="position:relative;width:96px;height:96px;">
<div id="energyBar"></div>👷</div>`;
game.appendChild(player);

let playerEnergy = 100;

function movePlayer(){
  if(playerEnergy<=0){ playerEnergy+=0.2; updateEnergy(); return; }
  if(trashes.length===0) return;
  let closest=null, minDist=Infinity;
  let px=parseFloat(player.style.left), py=parseFloat(player.style.top);
  for(let t of trashes){
    let tx = parseFloat(t.style.left), ty = parseFloat(t.style.top);
    let dist = Math.hypot(px-tx, py-ty);
    if(dist<minDist){ minDist=dist; closest=t; }
  }
  if(!closest) return;
  let tx=parseFloat(closest.style.left), ty=parseFloat(closest.style.top);
  let dx=tx-px, dy=ty-py, dist=Math.hypot(dx,dy);
  if(dist<5){
    pickTrash(closest);
  }else{
    player.style.left = px + dx*0.05 + 'px';
    player.style.top = py + dy*0.05 + 'px';
  }
  playerEnergy-=0.02;
  updateEnergy();
}

function pickTrash(t){
  if(audioOn) pickAudio.play();
  score+=parseInt(t.dataset.points);
  game.removeChild(t);
  trashes = trashes.filter(x=>x!==t);
  updateScore();
  if(trashes.length===0){
    if(audioOn) successAudio.play();
    setTimeout(()=>{
      if(confirm('任務成功！是否重新開始？')){
        location.reload();
      }
    },100);
  }
}

function updateScore(){
  document.getElementById('scoreBoard').innerText=`分數: ${score} | 剩餘垃圾: ${trashes.length}`;
}

function updateEnergy(){
  let bar = document.getElementById('energyBar');
  bar.style.width = playerEnergy+'%';
  bar.style.background = playerEnergy<20?'orange':'red';
}

function useMagnet(){
  for(let t of [...trashes]){
    let icon = t.innerText;
    if(icon.includes('🧴') || icon.includes('🥤')){
      pickTrash(t);
    }
  }
}
function useFan(){
  for(let t of trashes){
    t.style.left = parseFloat(t.style.left)+50 + 'px';
  }
}
function useRobot(){
  for(let i=0;i<5;i++){
    if(trashes[i]) pickTrash(trashes[i]);
  }
}

function animateTrash(){
  for(let t of trashes){
    let left=parseFloat(t.style.left);
    let top=parseFloat(t.style.top);
    t.style.left = left + Math.sin(Date.now()/500 + left)*0.2 + 'px';
    t.style.top = top + Math.sin(Date.now()/700 + top)*0.2 + 'px';
  }
}

function mainLoop(){
  animateTrash();
  movePlayer();
}
let gameLoop = setInterval(mainLoop,16);
</script>
</body>
</html>
